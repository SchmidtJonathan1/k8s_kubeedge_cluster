# /roles/kube_dependecies/tasks/dependencies_rhel.yml
---
# Set dependencies
- name: Install yum-utils
  ansible.builtin.dnf:
    name: yum-utils
    state: present

- name: Add kubernetes repo CentOS
  ansible.builtin.yum_repository:
    name: Kubernetes
    description: Kubernetes repo
    baseurl: "{{ repo_url_centos }}"
    enabled: yes
    gpgcheck: yes
    repo_gpgcheck: yes
    gpgkey: "{{ repo_gpg_centos }}"
  when: "ansible_default_ipv4.address == hostvars['primary1'].ansible_host"

- name: Add docker repo CentOS
  shell: "yum-config-manager --add-repo {{ repo_git_centos }}" 

- name: Update cache centos
  ansible.builtin.dnf:
    update_cache: yes

- name: Install dependencies on centos
  ansible.builtin.dnf:
    name:
      - curl
      - wget
      - ca-certificates
      - docker-ce
      - docker-ce-cli
      - containerd.io
    state: present

- name: Install only on primary node centos
  ansible.builtin.dnf:
    name:
      - kubeadm
      - kubelet
      - kubectl
    state: present
  when: ansible_default_ipv4.address == hostvars['primary1'].ansible_host
...